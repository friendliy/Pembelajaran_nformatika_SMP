<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kuis Informatika SMP</title>
  <link rel="stylesheet" href="style.css">
  <script src="auth.js"></script>
  <script src="cloud-sync.js"></script>
</head>
<body>
  <div class="container">
    <h1>📝 Kuis Informatika SMP</h1>
    
    <!-- Timer -->
    <div id="timer" class="timer">⏰ Waktu: 30:00</div>
    
    <!-- Progress indicator -->
    <div id="progress-container"></div>
    
    <!-- Quiz container -->
    <div class="content-card">
      <div id="quiz-container">
        <div style="text-align: center; padding: 40px;">
          <div style="font-size: 3rem; margin-bottom: 20px;">⏳</div>
          <p style="font-size: 1.2rem; color: #666; margin-bottom: 20px;">Memuat soal-soal quiz...</p>
          <div style="margin: 20px 0;">
            <button onclick="loadSampleQuestions()" style="background: #17a2b8; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; margin: 5px;">
              📝 Mulai Quiz Demo
            </button>
            <button onclick="loadQuestions()" style="background: #28a745; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; margin: 5px;">
              📚 Muat Soal Lengkap
            </button>
          </div>
          <div style="margin-top: 20px;">
            <button onclick="debugQuizSystem()" style="background: #6c757d; color: white; padding: 8px 16px; border: none; border-radius: 5px; cursor: pointer; font-size: 0.9rem; margin: 2px;">
              🔍 Debug Info
            </button>
            <button onclick="addTestAnswers()" style="background: #fd7e14; color: white; padding: 8px 16px; border: none; border-radius: 5px; cursor: pointer; font-size: 0.9rem; margin: 2px;">
              🧪 Isi Jawaban Test
            </button>
            <button onclick="console.clear(); console.log('Console cleared')" style="background: #dc3545; color: white; padding: 8px 16px; border: none; border-radius: 5px; cursor: pointer; font-size: 0.9rem; margin: 2px;">
              🗑️ Clear Console
            </button>
          </div>
          <div style="margin-top: 20px; padding: 15px; background: rgba(255,193,7,0.1); border-radius: 8px; font-size: 0.9rem; color: #856404;">
            <strong>📋 Panduan Penggunaan:</strong><br>
            1. <strong>Mulai Quiz:</strong> Klik "Mulai Quiz Demo" atau "Muat Soal Lengkap"<br>
            2. <strong>Test Mode:</strong> Klik "Isi Jawaban Test" untuk auto-fill jawaban<br>
            3. <strong>Debug:</strong> Tekan F12 → Console, lalu klik "Debug Info"<br>
            4. <strong>Reset:</strong> Gunakan "Hapus Semua Jawaban" atau "Refresh Halaman"<br>
            5. <strong>Submit:</strong> Klik "Kumpulkan Jawaban" kapan saja (partial submit OK)
          </div>
        </div>
      </div>
      
      <!-- Submit button -->
      <div style="text-align: center; margin-top: 30px;">
        <button id="submit-btn" onclick="submitQuiz()" style="padding: 12px 24px; font-size: 1rem; border-radius: 8px; border: none; cursor: pointer; margin: 5px;">📝 Kumpulkan Jawaban</button>
        <button onclick="testSubmit()" style="background: #ffc107; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px;">🧪 Test Submit</button>
        <br>
        <button onclick="clearAllAnswers()" style="background: #dc3545; color: white; padding: 8px 16px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; font-size: 0.9rem;">
          🗑️ Hapus Semua Jawaban
        </button>
        <button onclick="location.reload()" style="background: #6c757d; color: white; padding: 8px 16px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; font-size: 0.9rem;">
          🔄 Refresh Halaman
        </button>
      </div>
    </div>
    
    <!-- Results -->
    <div id="result" style="display: none; margin-top: 30px;"></div>
    
    <!-- Navigation -->
    <div class="nav-links">
      <a href="index.html">🏠 Kembali ke Beranda</a>
      <a href="dashboard.html">📊 Dashboard Guru</a>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    // Force load quiz after a short delay
    setTimeout(function() {
      console.log('Force loading quiz...');
      
      // If questions still not loaded, force load sample questions
      if (typeof loadSampleQuestions === 'function') {
        loadSampleQuestions();
      }
    }, 1000);
    
    // Initialize auth check after page loads
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Quiz page loaded, checking auth...');
      
      let currentUser = null;
      
      // Safely check for auth function
      try {
        if (typeof getCurrentUser === 'function') {
          currentUser = getCurrentUser();
        }
      } catch (error) {
        console.warn('Auth system not available, allowing guest access:', error);
      }
      
      // Show welcome/guest message
      const container = document.querySelector('.container h1');
      if (container) {
        let messageHTML = '';
        
        if (currentUser) {
          messageHTML = `
            <div style="background: rgba(102, 126, 234, 0.1); padding: 15px; border-radius: 10px; margin: 20px 0; text-align: center; border: 2px solid #667eea;">
              <h3 style="color: #667eea; margin: 0;">Selamat Datang, ${currentUser.fullName}!</h3>
              <p style="margin: 5px 0; color: #4a5568;">Anda login sebagai: <strong>${currentUser.role === 'siswa' ? '👨‍🎓 Siswa' : '👨‍🏫 Guru'}</strong></p>
            </div>
          `;
        } else {
          messageHTML = `
            <div style="background: rgba(255, 193, 7, 0.1); padding: 15px; border-radius: 10px; margin: 20px 0; text-align: center; border: 2px solid #ffc107;">
              <h3 style="color: #856404; margin: 0;">Mode Guest</h3>
              <p style="margin: 5px 0; color: #856404;">Anda dapat mengerjakan kuis sebagai tamu. Hasil akan tersimpan lokal.</p>
            </div>
          `;
        }
        
        container.insertAdjacentHTML('afterend', messageHTML);
      }
    });
  </script>
</body>
</html>
